<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login Page</title>
</head>
<body>

<div>
  <h2>Login</h2>
  <form onsubmit="event.preventDefault(); checkLogin();">
    <div>
      <label for="username">Username:</label>
      <input type="text" id="username" name="username" required>
    </div>
    <div>
      <label for="password">Password:</label>
      <input type="password" id="password" name="password" required>
    </div>
    <button type="submit">Login</button>
    <p id="errorMessage" style="color: red;"></p>
  </form>
</div>

<script>
  //proses login
  function checkLogin() {
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;

    // ID dari Spreadsheet Google Anda
    const spreadsheetId = '1Rw9tiukS0x95xo1wisWOTLCYKt96QDC2RTf1uoxy_DM';

    // Range data yang ingin Anda ambil
    const range = 'Users!A1:C';

    // API endpoint
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=AIzaSyBJ52mawoRgwYjQd9kPjx0gIwjvFlX4Ysc`;

    // Ambil data dari Google Sheets API
    fetch(url)
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then(data => {
        const users = data.values;
        const foundUser = users.find(user => user[0] === username && user[1] === password);
        if (foundUser) {
          // Login berhasil, lakukan tindakan setelah login berhasil
          console.log('Login berhasil');
          // Simpan status login pengguna di session storage
          sessionStorage.setItem('isLoggedIn', 'true');
          // Redirect ke halaman tujuan
          redirectToTargetPage();
        } else {
          // Login gagal, tampilkan pesan kesalahan
          document.getElementById('errorMessage').textContent = 'Username atau password salah';
        }
      })
      .catch(error => {
        console.error('Error fetching data:', error);
        // Tampilkan pesan kesalahan jika terjadi kesalahan saat mengambil data
        document.getElementById('errorMessage').textContent = 'Terjadi kesalahan saat mengambil data.';
      });
  }

  // Fungsi untuk mengarahkan pengguna ke halaman tujuan setelah login
  function redirectToTargetPage() {
    // Ganti dengan URL halaman tujuan Anda
    const targetPageUrl = 'https://lianmetofarm.github.io/input_recording/Recording%20Gudang%20Pakan.html';
    window.location.href = targetPageUrl;
  }

  // Pada halaman tujuan, periksa apakah pengguna telah login sebelumnya
  function checkIfLoggedIn() {
    const isLoggedIn = sessionStorage.getItem('isLoggedIn');
    if (!isLoggedIn || isLoggedIn !== 'true') {
      // Jika pengguna belum login, alihkan kembali ke halaman login
      redirectToLoginPage();
    }
  }

  // Fungsi untuk mengalihkan pengguna kembali ke halaman login
  function redirectToLoginPage() {
    // Ganti dengan URL halaman login Anda
    const loginPageUrl = 'https://lianmetofarm.github.io/login/login.html';
    window.location.href = loginPageUrl;
  }
</script>

</body>
</html>