<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Kandang Ayam</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs5/dt-1.11.5/datatables.min.css"/>
    <style>
        .chart-container {
            position: relative;
            margin-top: 20px;
        }
        canvas {
            max-width: 100%;
            height: auto;
        }
        .fs-responsive {
            font-size: 1.2em; /* Ganti dengan ukuran font yang sesuai */
        }
        /* New styles for div structure */
        .data-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        .data-box {
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 20px;
            width: calc(50% - 20px);
            box-sizing: border-box;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

<div class="container">
    <h2 class="my-4 text-center">Informasi Grafik</h2>
</div>

<div class="container">
    <div class="row">
        <div class="col-xl-8 col-12 mb-5">
            <div class="card" data-aos="fade-up" data-aos-delay="800">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4 class="mb-0">Produksi Telur</h4>
                </div>
                <div class="card-body">                 
                    <canvas id="barChart" class="chart-container"></canvas>
                </div>
                
                <div class="card-footer">
                    <div class="row bg-light rounded-3">
                        <div class="col-lg-4 col-md-6">
                            <div class="p-4">
                                <span><i class="mdi mdi-circle small me-0 text-primary"></i>Total Rak Utuh</span>
                                <h3 id="totalRakUtuh" class="mb-2 mt-2 fs-responsive text-success"></h3>
                                <span><i class="mdi mdi-circle small me-0 text-primary"></i>Total Butir Utuh</span>
                                <h3 id="totalButirUtuh" class="mb-0 mt-2 fs-responsive text-success"></h3>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="p-4">
                                <span><i class="mdi mdi-circle small me-0 text-primary"></i>Total Rak Retak</span>
                                <h3 id="totalRakRetak" class="mb-2 mt-2 fs-responsive text-success"></h3>
                                <span><i class="mdi mdi-circle small me-0 text-primary"></i>Total Butir Retak</span>
                                <h3 id="totalButirRetak" class="mb-0 mt-2 fs-responsive text-success"></h3>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="p-4">
                                <span><i class="mdi mdi-circle small me-0 text-primary"></i>Total Rak Pecah</span>
                                <h3 id="totalRakPecah" class="mb-2 mt-2 fs-responsive text-success"></h3>
                                <span><i class="mdi mdi-circle small me-0 text-primary"></i>Total Butir Pecah</span>
                                <h3 id="totalButirPecah" class="mb-0 mt-2 fs-responsive text-success"></h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-4 col-12 mb-5">
            <div class="card h-100">
              <div class="card-header">
                <h4 class="mb-0">Kematian Ayam</h4>
              </div>
              <div class="card-body">
                <canvas id="pieChart" class="chart-container"></canvas>
            </div>
            
            </div>
        </div>

    </div>
</div>

<div class="container">
    <h1 class="my-4">Data Kandang 2</h1>
    <div class="table-responsive table-borderless mb-0 mt-5 data-container" id="data-container"></div>
</div>

<!-- Bootstrap Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
<!-- jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<!-- DataTables -->
<script type="text/javascript" src="https://cdn.datatables.net/v/bs5/dt-1.11.5/datatables.min.js"></script>
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    $(document).ready(function() {
        // API key untuk Google Sheets API
        var apiKey = 'AIzaSyBJ52mawoRgwYjQd9kPjx0gIwjvFlX4Ysc';
        // ID dari spreadsheet
        var spreadsheetId = '1Rw9tiukS0x95xo1wisWOTLCYKt96QDC2RTf1uoxy_DM';

        // Daftar nama sheet yang ingin diambil
        var sheetNames = ['Kandang 2'];

        // Kolom yang ingin ditampilkan (indeks dimulai dari 0)
        var columnsToDisplay = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17]; // Kolom A (0), B (1), dan E (4)
        var columnTitles = ['Id', 'Tanggal', 'Minggu', 'Umur', 'Ayam Mati', 'Ayam Afkir', 'Sisa Ayam', 'Rak Utuh', 'Butir Utuh', 'Rak Retak', 'Butir Retak', 'Rak Pecah', 'Butir Pecah', 'HD%', 'HH%', 'Pakan', 'Intek', 'Keteragan']; // Judul Kolom

        // Endpoint API untuk mendapatkan metadata tentang spreadsheet
        var baseUrl = 'https://sheets.googleapis.com/v4/spreadsheets/';
        var url = baseUrl + spreadsheetId + '?key=' + apiKey;

        // Ambil metadata tentang spreadsheet
        $.get(url, function(data) {
            var sheets = data.sheets;

            // Loop melalui setiap sheet
            for (var i = 0; i < sheets.length; i++) {
                var sheet = sheets[i];
                var sheetTitle = sheet.properties.title;

                // Jika sheet ada dalam daftar yang diinginkan
                if (sheetNames.includes(sheetTitle)) {
                    var sheetId = sheet.properties.sheetId;

                    // Endpoint API untuk mendapatkan data dari sheet tertentu
                    var range = sheetTitle + '!A11:U';
                    var sheetUrl = baseUrl + spreadsheetId + '/values/' + range + '?key=' + apiKey;

                    // Ambil data dari sheet
                    $.get(sheetUrl, function(sheetData) {
                        if (sheetData && sheetData.values && sheetData.values.length > 0) {
                            var rows = sheetData.values;

                            // Tambahkan data ke dalam div menggunakan format yang sesuai
                            var dataContainer = $('#data-container');
                            dataContainer.empty();
                            rows.forEach(function(row) {
                                var dataBox = $('<div class="data-box"></div>');
                                dataBox.append('<p><strong>' + columnTitles[0] + ':</strong> ' + row[0] + '</p>');
                                dataBox.append('<p><strong>' + columnTitles[1] + ':</strong> ' + row[1] + '</p>');
                                dataBox.append('<p><strong>' + columnTitles[2] + ':</strong> ' + row[2] + '</p>');
                                dataBox.append('<p><strong>' + columnTitles[3] + ':</strong> ' + row[3] + '</p>');
                                dataBox.append('<p><strong>' + columnTitles[4] + ':</strong> ' + row[4] + '</p>');
                                dataBox.append('<p><strong>' + columnTitles[5] + ':</strong> ' + row[5] + '</p>');
                                dataBox.append('<p><strong>' + columnTitles[6] + ':</strong> ' + row[6] + '</p>');
                                dataBox.append('<p><strong>' + columnTitles[7] + ':</strong> ' + row[7] + '</p>');
                                dataBox.append('<p><strong>' + columnTitles[8] + ':</strong> ' + row[8] + '</p>');
                                dataBox.append('<p><strong>' + columnTitles[9] + ':</strong> ' + row[9] + '</p>');
                                dataBox.append('<p><strong>' + columnTitles[10] + ':</strong> ' + row[10] + '</p>');
                                dataBox.append('<p><strong>' + columnTitles[11] + ':</strong> ' + row[11] + '</p>');
                                dataBox.append('<p><strong>' + columnTitles[12] + ':</strong> ' + row[12] + '</p>');
                                dataBox.append('<p><strong>' + columnTitles[13] + ':</strong> ' + row[13] + '</p>');
                                dataBox.append('<p><strong>' + columnTitles[14] + ':</strong> ' + row[14] + '</p>');
                                dataBox.append('<p><strong>' + columnTitles[15] + ':</strong> ' + row[15] + '</p>');
                                dataBox.append('<p><strong>' + columnTitles[16] + ':</strong> ' + row[16] + '</p>');
                                dataBox.append('<p><strong>' + columnTitles[17] + ':</strong> ' + row[17] + '</p>');
                                dataContainer.append(dataBox);
                            });
                        } else {
                            console.log('Data tidak tersedia atau tidak valid.');
                        }
                    }).fail(function() {
                        console.log('Gagal mengambil data dari spreadsheet.');
                    });
                }
            }
        }).fail(function() {
            console.log('Gagal mengambil metadata tentang spreadsheet.');
        });
    });
</script>

</body>
</html>