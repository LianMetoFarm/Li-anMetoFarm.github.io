<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Kandang Ayam</title>
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    .table-responsive {
        height: 400px;
        overflow: scroll;
    }

    table {
        border-collapse: collapse;
    }

    th, td {
        padding: 12px 15px;
        text-align: left;
    }

    tr:nth-child(even) {
        background-color: #f2f2f2;
    }

    tr:hover {
        background-color: #ddd;
    }

    thead th {
        background-color: #356ea7;
        position: sticky;
        top: 0;
        z-index: 999;
        opacity: 1;
    }

    tbody td {
        background-color: #fff;
    }
</style>
</head>
<body>

<div class="container">
    <h1 class="my-4">Data Kandang 2</h1>
    <div class="table-responsive" id="data-container"></div>
</div>

<div class="container">
    <div class="row">
        <div class="col-md-6">
            <div class="row mt-4">
                <div class="col-md-12">
                    <p>Total Ayam Masuk : <span id="totalAyam"></span></p>
                </div>
                <div class="col-md-4">
                    <p>Total Ayam Mati : <span id="totalAyamMati"></span></p>
                </div>
                <div class="col-md-4">
                    <p>Total Ayam Afkir : <span id="totalAyamAfkir"></span></p>
                </div>
                <div class="col-md-4">
                    <p>Total Sisa Ayam : <span id="totalSisaAyam"></span></p>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="chart-container">
                        <canvas id="pieChart"></canvas>
                        <canvas id="barChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="row mt-4">
                <div class="col-md-4">
                    <p>Total Rak Utuh : <span id="totalRakUtuh"></span></p>
                    <p>Total Butir Utuh : <span id="totalButirUtuh"></span></p>
                </div>
                <div class="col-md-4">
                    <p>Total Rak Retak : <span id="totalRakRetak"></span></p>
                    <p>Total Butir Retak : <span id="totalButirRetak"></span></p>
                </div>
                <div class="col-md-4">
                    <p>Total Rak Pecah : <span id="totalRakPecah"></span></p>
                    <p>Total Butir Pecah : <span id="totalButirPecah"></span></p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    $(document).ready(function() {
        // API key untuk Google Sheets API
        var apiKey = 'AIzaSyBJ52mawoRgwYjQd9kPjx0gIwjvFlX4Ysc';
        // ID dari spreadsheet
        var spreadsheetId = '1Rw9tiukS0x95xo1wisWOTLCYKt96QDC2RTf1uoxy_DM';

        // Daftar nama sheet yang ingin diambil
        var sheetNames = ['Kandang 2'];

        // Kolom yang ingin ditampilkan (indeks dimulai dari 0)
        var columnsToDisplay = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17]; // Kolom A (0), B (1), dan E (4)
        var columnTitles = ['Id', 'Tanggal', 'Minggu', 'Umur', 'Ayam Mati', 'Ayam Afkir', 'Sisa Ayam', 'Rak Utuh', 'Butir Utuh', 'Rak Retak', 'Butir Retak', 'Rak Pecah', 'Butir Pecah', 'HD%', 'HH%', 'Pakan', 'Intek', 'Keteragan']; // Judul Kolom

        // Endpoint API untuk mendapatkan metadata tentang spreadsheet
        var baseUrl = 'https://sheets.googleapis.com/v4/spreadsheets/';
        var url = baseUrl + spreadsheetId + '?key=' + apiKey;

        // Ambil metadata tentang spreadsheet
        $.get(url, function(data) {
            var sheets = data.sheets;

            // Loop melalui setiap sheet
            for (var i = 0; i < sheets.length; i++) {
                var sheet = sheets[i];
                var sheetTitle = sheet.properties.title;

                // Jika sheet ada dalam daftar yang diinginkan
                if (sheetNames.includes(sheetTitle)) {
                    var sheetId = sheet.properties.sheetId;

                    // Endpoint API untuk mendapatkan data dari sheet tertentu
                    var range = sheetTitle + '!A11:U100';
                    var sheetUrl = baseUrl + spreadsheetId + '/values/' + range + '?key=' + apiKey;

                    // Ambil data dari sheet
                    $.get(sheetUrl, function(sheetData) {
                        if (sheetData && sheetData.values && sheetData.values.length > 0) {
                            var rows = sheetData.values;

                            // Tambahkan data ke dalam tabel
                            var table = $('<table>').addClass('table table-striped text-successtable-border');
                            // Tambahkan elemen thead
                            var thead = $('<thead>');
                            // Tambahkan baris judul kolom
                            var headerRow = $('<tr>');
                            for (var k = 0; k < columnsToDisplay.length; k++) {
                                headerRow.append($('<th>').text(columnTitles[k]));
                            }
                            thead.append(headerRow);
                            table.append(thead);

                            // Tambahkan data
                            for (var j = 0; j < rows.length; j++) {
                                var row = $('<tr>');
                                for (var k = 0; k < columnsToDisplay.length; k++) {
                                    var columnIndex = columnsToDisplay[k];
                                    row.append($('<td>').text(rows[j][columnIndex]));
                                }
                                table.append(row);
                            }

                            // Tambahkan tabel ke dalam dokumen
                            $('#data-container').append(table);

                            // Hitung total ayam
                            var totalAyam = parseInt(rows[0][6] || 0);

                            // Hitung total ayam mati dan total ayam afkir
                            var totalAyamMati = rows.reduce((total, row) => total + parseInt(row[4] || 0), 0);
                            var totalAyamAfkir = rows.reduce((total, row) => total + parseInt(row[5] || 0), 0);

                            // Hitung total sisa ayam
                            var totalSisaAyam = parseInt(rows[0][6] || 0) - totalAyamMati - totalAyamAfkir;

                            // Hitung total rak utuh, butir utuh, rak retak, butir retak, rak pecah, dan butir pecah
                            var totalRakUtuh = rows.reduce((total, row) => total + parseInt(row[7] || 0), 0);
                            var totalButirUtuh = rows.reduce((total, row) => total + parseInt(row[8] || 0), 0);
                            var totalRakRetak = rows.reduce((total, row) => total + parseInt(row[9] || 0), 0);
                            var totalButirRetak = rows.reduce((total, row) => total + parseInt(row[10] || 0), 0);
                            var totalRakPecah = rows.reduce((total, row) => total + parseInt(row[11] || 0), 0);
                            var totalButirPecah = rows.reduce((total, row) => total + parseInt(row[12] || 0), 0);

                            // Tampilkan total ayam mati, total ayam afkir, total sisa ayam, total rak utuh, total butir utuh, total rak retak, total butir retak, total rak pecah, dan total butir pecah
                            $('#totalAyam').text(totalAyam);
                            $('#totalAyamMati').text(totalAyamMati);
                            $('#totalAyamAfkir').text(totalAyamAfkir);
                            $('#totalSisaAyam').text(totalSisaAyam);
                            $('#totalRakUtuh').text(totalRakUtuh);
                            $('#totalButirUtuh').text(totalButirUtuh);
                            $('#totalRakRetak').text(totalRakRetak);
                            $('#totalButirRetak').text(totalButirRetak);
                            $('#totalRakPecah').text(totalRakPecah);
                            $('#totalButirPecah').text(totalButirPecah);

                            // Tambahkan grafik pie
                            var ctx1 = document.getElementById('pieChart').getContext('2d');
                            var pieChart = new Chart(ctx1, {
                                type: 'pie',
                                data: {
                                    labels: ['Ayam Mati', 'Ayam Afkir'],
                                    datasets: [{
                                        label: 'Ayam',
                                        data: [totalAyamMati, totalAyamAfkir],
                                        backgroundColor: [
                                            'rgba(255, 99, 132, 0.2)',
                                            'rgba(54, 162, 235, 0.2)'
                                        ],
                                        borderColor: [
                                            'rgba(255, 99, 132, 1)',
                                            'rgba(54, 162, 235, 1)'
                                        ],
                                        borderWidth: 1
                                    }]
                                },
                                options: {
                                    scales: {
                                        y: {
                                            beginAtZero: true
                                        }
                                    }
                                }
                            });

                            // Tambahkan grafik bar
                            var ctx2 = document.getElementById('barChart').getContext('2d');
                            var barChart = new Chart(ctx2, {
                                type: 'bar',
                                data: {
                                    labels: rows.map(row => row[1]), // Menggunakan kolom kedua sebagai label (misalnya, tanggal)
                                    datasets: [
                                        {
                                            label: 'Rak Utuh',
                                            data: rows.map(row => parseInt(row[7])), // Menggunakan kolom kedelapan sebagai data (misalnya, jumlah Rak utuh)
                                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                                            borderColor: 'rgba(255, 99, 132, 1)',
                                            borderWidth: 1
                                        },
                                        {
                                            label: 'Butir Utuh',
                                            data: rows.map(row => parseInt(row[8])), // Menggunakan kolom kesembilan sebagai data (misalnya, jumlah Butir utuh)
                                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                                            borderColor: 'rgba(54, 162, 235, 1)',
                                            borderWidth: 1
                                        },
                                        {
                                            label: 'Rak Retak',
                                            data: rows.map(row => parseInt(row[9])), // Menggunakan kolom kesepuluh sebagai data (misalnya, jumlah Rak Retak)
                                            backgroundColor: 'rgba(255, 206, 86, 0.2)',
                                            borderColor: 'rgba(255, 206, 86, 1)',
                                            borderWidth: 1
                                        },
                                        {
                                            label: 'Butir Retak',
                                            data: rows.map(row => parseInt(row[10])), // Menggunakan kolom kesebelas sebagai data (misalnya, jumlah Butir Retak)
                                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                            borderColor: 'rgba(75, 192, 192, 1)',
                                            borderWidth: 1
                                        },
                                        {
                                            label: 'Rak Pecah',
                                            data: rows.map(row => parseInt(row[11])), // Menggunakan kolom keduabelas sebagai data (misalnya, jumlah Rak Pecah)
                                            backgroundColor: 'rgba(153, 102, 255, 0.2)',
                                            borderColor: 'rgba(153, 102, 255, 1)',
                                            borderWidth: 1
                                        },
                                        {
                                            label: 'Butir Pecah',
                                            data: rows.map(row => parseInt(row[12])), // Menggunakan kolom ketigabelas sebagai data (misalnya, jumlah Butir Pecah)
                                            backgroundColor: 'rgba(255, 159, 64, 0.2)',
                                            borderColor: 'rgba(255, 159, 64, 1)',
                                            borderWidth: 1
                                        }
                                    ]
                                },
                                options: {
                                    scales: {
                                        y: {
                                            beginAtZero: true
                                        }
                                    }
                                }
                            });
                        } else {
                            console.log('Data tidak tersedia atau tidak valid.');
                        }
                    }).fail(function() {
                        console.log('Gagal mengambil data dari spreadsheet.');
                    });
                }
            }
        }).fail(function() {
            console.log('Gagal mengambil metadata tentang spreadsheet.');
        });
    });
</script>

</body>
</html>