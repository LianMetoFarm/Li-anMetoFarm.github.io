<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Kandang Ayam</title>
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    .table-responsive {
        max-height: 400px;
        overflow: scroll;
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }

    th, td {
        padding: 12px 15px;
        text-align: left;
    }

    tr:nth-child(even) {
        background-color: #f2f2f2;
    }

    tr:hover {
        background-color: #ddd;
    }

    thead th {
        background-color: #f8f9fa; /* Ganti warna latar belakang sesuai kebutuhan */
        position: sticky;
        top: 0;
        z-index: 999;
        opacity: 10; /* Mengubah opacity menjadi 1 */
    }

    tbody td {
        background-color: #fff;
    }
</style>
</head>
<body>

<div class="container">
    <h1 class="my-4">Data Kandang Ayam</h1>
    <div class="table-responsive" id="data-container"></div>
    <canvas id="myChart"></canvas>
    <div class="row mt-4">
        <div class="col-md-12">
            <p>Total Ayam Masuk : <span id="totalAyam"></span></p>
        </div>
        <div class="col-md-4">
            <p>Total Ayam Mati : <span id="totalAyamMati"></span></p>
        </div>
        <div class="col-md-4">
            <p>Total Ayam Afkir : <span id="totalAyamAfkir"></span></p>
        </div>
        <div class="col-md-4">
            <p>Total Sisa Ayam : <span id="totalSisaAyam"></span></p>
        </div>
    </div>
</div>

<!-- Bootstrap Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    $(document).ready(function() {
        // API key untuk Google Sheets API
        var apiKey = 'AIzaSyBJ52mawoRgwYjQd9kPjx0gIwjvFlX4Ysc';
        // ID dari spreadsheet
        var spreadsheetId = '1Rw9tiukS0x95xo1wisWOTLCYKt96QDC2RTf1uoxy_DM';

        // Daftar nama sheet yang ingin diambil
        var sheetNames = ['Kandang 2'];

        // Kolom yang ingin ditampilkan (indeks dimulai dari 0)
        var columnsToDisplay = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17]; // Kolom A (0), B (1), dan E (4)
        var columnTitles = ['Id', 'Tanggal', 'Minggu', 'Umur', 'Ayam Mati', 'Ayam Afkir', 'Sisa Ayam', 'Rak Utuh', 'Butir Utuh', 'Rak Retak', 'Butir Retak', 'Rak Pecah', 'Butir Pecah', 'HD%', 'HH%', 'Pakan', 'Intek', 'Keteragan']; // Judul Kolom

        // Endpoint API untuk mendapatkan metadata tentang spreadsheet
        var baseUrl = 'https://sheets.googleapis.com/v4/spreadsheets/';
        var url = baseUrl + spreadsheetId + '?key=' + apiKey;

        // Ambil metadata tentang spreadsheet
        $.get(url, function(data) {
            var sheets = data.sheets;

            // Loop melalui setiap sheet
            for (var i = 0; i < sheets.length; i++) {
                var sheet = sheets[i];
                var sheetTitle = sheet.properties.title;

                // Jika sheet ada dalam daftar yang diinginkan
                if (sheetNames.includes(sheetTitle)) {
                    var sheetId = sheet.properties.sheetId;

                    // Endpoint API untuk mendapatkan data dari sheet tertentu
                    var range = sheetTitle + '!A11:U100';
                    var sheetUrl = baseUrl + spreadsheetId + '/values/' + range + '?key=' + apiKey;

                    // Ambil data dari sheet
                    $.get(sheetUrl, function(sheetData) {
                        if (sheetData && sheetData.values && sheetData.values.length > 0) {
                            var rows = sheetData.values;

                            // Tambahkan data ke dalam tabel
                            var table = $('<table>').addClass('table table-striped text-successtable-border');
                            // Tambahkan elemen thead
                            var thead = $('<thead>');
                            // Tambahkan baris judul kolom
                            var headerRow = $('<tr>');
                            for (var k = 0; k < columnsToDisplay.length; k++) {
                                headerRow.append($('<th>').text(columnTitles[k]));
                            }
                            thead.append(headerRow);
                            table.append(thead);

                            // Tambahkan data
                            for (var j = 0; j < rows.length; j++) {
                                var row = $('<tr>');
                                for (var k = 0; k < columnsToDisplay.length; k++) {
                                    var columnIndex = columnsToDisplay[k];
                                    row.append($('<td>').text(rows[j][columnIndex]));
                                }
                                table.append(row);
                            }

                            // Tambahkan tabel ke dalam dokumen
                            $('#data-container').append(table);

                            // Hitung total ayam
                            var totalAyam = parseInt(rows[0][6] || 0);

                            // Hitung total ayam mati dan total ayam afkir
                            var totalAyamMati = rows.reduce((total, row) => total + parseInt(row[4] || 0), 0);
                            var totalAyamAfkir = rows.reduce((total, row) => total + parseInt(row[5] || 0), 0);

                            // Hitung total sisa ayam
                            var totalSisaAyam = parseInt(rows[0][6] || 0) - totalAyamMati - totalAyamAfkir;


                            // Tampilkan total ayam mati, total ayam afkir, total sisa ayam, dan total ayam
                            $('#totalAyam').text(totalAyam);
                            $('#totalAyamMati').text(totalAyamMati);
                            $('#totalAyamAfkir').text(totalAyamAfkir);
                            $('#totalSisaAyam').text(totalSisaAyam);

                            // Tambahkan grafik
                            var ctx = document.getElementById('myChart').getContext('2d');
                            var myChart = new Chart(ctx, {
                                type: 'pie',
                                data: {
                                    labels: ['Ayam Mati', 'Ayam Afkir'],
                                    datasets: [{
                                        label: 'Ayam',
                                        data: [totalAyamMati, totalAyamAfkir],
                                        backgroundColor: [
                                            'rgba(255, 99, 132, 0.2)',
                                            'rgba(54, 162, 235, 0.2)'
                                        ],
                                        borderColor: [
                                            'rgba(255, 99, 132, 1)',
                                            'rgba(54, 162, 235, 1)'
                                        ],
                                        borderWidth: 1
                                    }]
                                },
                                options: {
                                    scales: {
                                        y: {
                                            beginAtZero: true
                                        }
                                    }
                                }
                            });
                        } else {
                            console.log('Data tidak tersedia atau tidak valid.');
                        }
                    }).fail(function() {
                        console.log('Gagal mengambil data dari spreadsheet.');
                    });
                }
            }
        }).fail(function() {
            console.log('Gagal mengambil metadata tentang spreadsheet.');
        });
    });
</script>

</body>
</html>